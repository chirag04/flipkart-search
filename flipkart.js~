var http = require('http');
var url = require('url');
var request = require('request');
var $ = require('cheerio');

http.createServer(function (req, res) {
	var queryData = url.parse(req.url, true).query;
	var keyword = queryData.q ? queryData.q || "";
	console.log(keyword);
	request('http://www.flipkart.com/m/search-books?query='+keyword, function (error, response, body) {
		if (error) {
			res.writeHead(200, {'Content-Type': 'application/json'});
			res.end({"error":error});
		} else {
			var parsedHTML = $.load(body);
			var titles = [];
			parsedHTML('.searchresult-details h2 a').each(function(i,element){
				titles.push($(element).text());
			});
			res.writeHead(200, {'Content-Type': 'application/json'});
			res.end({"titles":titles});
		}
	});
}).listen(3001, '127.0.0.1');
console.log('Flipkart Server running at http://127.0.0.1:3001/');
